<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="fproject.app.mybatis.mapper.WebsocketMapper">
	<!-- ### 특정 방 정보 얻기 ### -->
	<select id="getRoom" parameterType="int" 
			resultType="fproject.app.fproject.vo.ChatlistVo">
		SELECT * FROM CHATLIST 
		WHERE CLNUM=#{CLNUM}
	</select>
	<!-- ### 방 추가하기 ### -->
	<insert id="createChatRoom" parameterType="fproject.app.fproject.vo.ChatlistVo">
		INSERT INTO CHATLIST 
		VALUES(SEQ_CLNUM.NEXTVAL, #{NAME})
	</insert>
	<!-- ### 전체 방 정보 얻어오기 ### --> 
	<select id="getRoomList" resultType="fproject.app.fproject.vo.ChatlistVo">
		SELECT * FROM CHATLIST
	</select>
	<!-- ### 어떤 방에 들어가있는지(들어갈건지) ### -->
	<!-- ### 본인과 초대한 유저 추가하기 ### -->
	<insert id="addAttendInfo" parameterType="fproject.app.fproject.vo.AttendinfoVo">
		INSERT INTO ATTENDINFO 
		VALUES(#{CLNUM},#{NUM},#{STATE})
	</insert>
	<!-- ### 현재 유저가 어떤방에 들어가있는지 ### -->
	<select id="getAttendInfo" parameterType="int"
			resultType="fproject.app.fproject.vo.AttendinfoVo">
		SELECT * FROM ATTENDINFO 
		WHERE NUM=#{NUM}
	</select>
	<select id="getAttendInfotoclnum" parameterType="int"
			resultType="fproject.app.fproject.vo.AttendinfoVo">
		SELECT * FROM ATTENDINFO 
		WHERE CLNUM=#{CLNUM}
	</select>
	<!-- ### (파라미터)같은 방에 존재하는 사람 정보 가져오기 ### -->
	<select id="sameAttendInfo" parameterType="int"
			resultType="fproject.app.fproject.vo.AttendinfoVo">
		SELECT * FROM ATTENDINFO 
		WHERE CLNUM=#{CLNUM}
	</select>
	<!-- ### (파라미터)방에 있는 인원 수 얻어오기 ### -->
	<select id="getAttendCount" parameterType="int"
			resultType="int">
		SELECT COUNT(*) CNT FROM ATTENDINFO
		WHERE CLNUM=#{CLNUM}
	</select>
	<!-- ### 방 변경 ### --><!-- 
	<update id="updateRoom" parameterType="fproject.app.fproject.AttendinfoVo">
		<if test="clnum !=null and clnum !=''">
			UPDATE CHATLIST SET CLNUM=#{CLNUM} 
			WHERE NUM=#{NUM}
		</if>
	</update>
	 -->
	<!-- ### 방 정보 제거 ### -->
	<delete id="deleteRoom" parameterType="fproject.app.fproject.vo.AttendinfoVo">
		DELETE FROM ATTENDINFO 
		WHERE CLNUM=#{CLNUM} AND NUM=#{NUM}
	</delete>
	<select id="searchRoomList" parameterType="String" 
			resultType="fproject.app.fproject.vo.ChatlistVo">
		SELECT * FROM CHATLIST
		WHERE NAME LIKE '%'||#{NAME}||'%'
	</select>
	
	<!-- 채팅 추가 -->
	<insert id="addChat" parameterType="fproject.app.fproject.vo.ChatVo"> 
		INSERT INTO CHAT
		VALUES(SEQ_CNUM.NEXTVAL,#{state},#{content},SYSDATE,#{emoticonnum},#{orgimg},#{saveimg},#{imgsize},#{clnum},#{num})
	</insert>
	<!-- 해당 방의 채팅내용 가져오기 -->
	<select id="getChat" parameterType="int"
			resultType="fproject.app.fproject.vo.ChatVo">
		SELECT * FROM CHAT
		WHERE CLNUM=#{CLNUM}
	</select>
</mapper>